{
    "sourceFile": "src/pages/estoque/gestao/CadastroVeiculoBIN.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 61,
            "patches": [
                {
                    "date": 1769800675405,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1769800722394,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,323 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769800732395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,323 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status , data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769800758627,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,323 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801559722,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -267,8 +267,11 @@\n                             <div className=\"col-12 col-md-3\">\r\n                                 <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n                                     value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n                             </div>\r\n+                                          {loading && (\r\n+                <div class=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n+              )}\r\n                             <div className=\"col-12 col-md-3\">\r\n                                 <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n                             </div>\r\n                             <div className=\"col-12 col-md-4\">\r\n@@ -320,973 +323,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status , data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loadingdata: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801566736,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,326 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {sta && (\r\n+                                <div class=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801573513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,326 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801599658,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,326 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border \" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801612728,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -263,14 +263,14 @@\n                                     <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n                                     <option values='pulmao'>ESTOQUE EXTRA</option>\r\n                                 </select>\r\n                             </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n+                            <div className=\"col-12 col-md-2\">\r\n                                 <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n                                     value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n                             </div>\r\n                             {status && (\r\n-                                <div className=\"spinner-border \" role=\"status\"></div>\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n                             )}\r\n                             <div className=\"col-12 col-md-3\">\r\n                                 <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n                             </div>\r\n@@ -323,982 +323,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {sta && (\r\n-                                <div class=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                                          {loading && (\r\n-                <div class=\"spinner-border spinner-border-sm\" role=\"status\"></div>\r\n-              )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801715462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,335 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+              const timeoutId = setTimeout(() => {\r\n+        window.alert(\r\n+          \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+        );\r\n+        window.location.reload();\r\n+      }, 120000);\r\n+\r\n+      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801729156,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,327 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801736089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,336 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = () => {\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+                  const timeoutId = setTimeout(() => {\r\n+        window.alert(\r\n+          \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+        );\r\n+        window.location.reload();\r\n+      }, 120000);\r\n+\r\n+      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801784817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,336 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801795143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,336 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+X\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801826263,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,337 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            \r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801838984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            setStatus(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801924731,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801982967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,9 +51,9 @@\n         if (placaM.length === 7) {\r\n \r\n             const timeoutId = setTimeout(() => {\r\n                 window.alert(\r\n-                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                    \"BASE BIN offline ou veiculo indisponivel na base. Tente novamente ou realize o cadastro de forma manual. \"\r\n                 );\r\n                 window.location.reload();\r\n             }, 120000);\r\n \r\n@@ -335,2675 +335,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            setStatus(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            \r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-X\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-                  const timeoutId = setTimeout(() => {\r\n-        window.alert(\r\n-          \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-        );\r\n-        window.location.reload();\r\n-      }, 120000);\r\n-\r\n-      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-              const timeoutId = setTimeout(() => {\r\n-        window.alert(\r\n-          \"BASE BIN offline ou com conexao instável. Tente novamente ou realize o cadastro de forma manual. \"\r\n-        );\r\n-        window.location.reload();\r\n-      }, 120000);\r\n-\r\n-      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = () => {\r\n-        const placaM = placa.toUpperCase();\r\n-        if (placaM.length === 7) {\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769801994961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802051712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802061199,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner bar\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802066285,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802073078,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802081566,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-bar\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802087338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-borde\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802098596,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border p\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802115459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802140927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\">Buscando dados</div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802149150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802154264,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\">></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802160384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\">-></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802173473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802181205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            \r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802187528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            {status && (\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            \r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802195414,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -275,352 +275,12 @@\n                                     <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n                                     <option values='pulmao'>ESTOQUE EXTRA</option>\r\n                                 </select>\r\n                             </div>\r\n-                            {status && (\r\n                             <div className=\"col-12 col-md-2\">\r\n                                 <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n                                     value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n                             </div>\r\n-                            \r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            \r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n                             {status && (\r\n                                 <div className=\"spinner-border\" role=\"status\" ></div>\r\n                             )}\r\n                             <div className=\"col-12 col-md-3\">\r\n@@ -675,5074 +335,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\">-></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\">></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\">Buscando dados</div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border p\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-borde\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-bar\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner bar\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou veiculo indisponivel na base. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802231588,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n     const handleBlur = async () => {\r\n         const placaM = placa.toUpperCase();\r\n \r\n         if (placaM.length === 7) {\r\n-\r\n+            \r\n             const timeoutId = setTimeout(() => {\r\n                 window.alert(\r\n                     \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n                 );\r\n"
                },
                {
                    "date": 1769802239148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            status(true)\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802251357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            status)\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802257311,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+\r\n+        if (placaM.length === 7) {\r\n+\r\n+            status(false))\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802331019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        const placaM = placa.toUpperCase();\r\n+status(false)\r\n+        if (placaM.length === 7) {\r\n+\r\n+            \r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802338990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        \r\n+        const placaM = placa.toUpperCase();\r\n+        status(false)\r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802344215,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(false)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769802353473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769804666817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            status(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769804678332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {status && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769804703223,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769804741998,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769805145836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806490614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\" style={{marginRight: '15px'}}></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806496669,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\" style={{marginRight: '25px'}}></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806523833,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806537703,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border \" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806547690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border col-12 col-md-4\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806559513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border \" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806572811,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1769806581217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,339 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770104218863,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -276,12 +276,13 @@\n                                     <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n                                     <option values='pulmao'>ESTOQUE EXTRA</option>\r\n                                 </select>\r\n                             </div>\r\n-                            <div className=\"col-12 col-md-\">\r\n+                            <div className=\"col-12 col-md-2\">\r\n                                 <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n                                     value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n                             </div>\r\n+                            \r\n                             {loading && (\r\n                                 <div className=\"spinner-border\" role=\"status\"></div>\r\n                             )}\r\n                             <div className=\"col-12 col-md-4\">\r\n@@ -336,6790 +337,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border \" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border col-12 col-md-4\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border \" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\" style={{marginRight: '25px'}}></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\" style={{marginRight: '15px'}}></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(false)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        \r\n-        const placaM = placa.toUpperCase();\r\n-        status(false)\r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-status(false)\r\n-        if (placaM.length === 7) {\r\n-\r\n-            \r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            status(false))\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            status)\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-\r\n-            status(true)\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { status, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        const placaM = placa.toUpperCase();\r\n-\r\n-        if (placaM.length === 7) {\r\n-            \r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            status(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {status && (\r\n-                                <div className=\"spinner-border\" role=\"status\" ></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770104224875,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {/**/ */}\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770104232748,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,340 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {/* }\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770104242063,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,341 @@\n+import \"../../../assets/css/thead.css\";\r\n+import \"../../../assets/css/themify-icons.css\"\r\n+import Form from '../../../components/form/Form';\r\n+import Box from \"../../../components/box/Box\"\r\n+import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n+import Input from '../../../components/input/Input';\r\n+\r\n+import { useState, useEffect, useRef } from 'react';\r\n+import { useGetData } from '../../../services/useGetData';\r\n+import { usePostData } from '../../../services/usePostData';\r\n+import { formatTimestamp } from '../../../hooks/formatDate';\r\n+import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n+import Button from '../../../components/button/Button';\r\n+import { formatMillionUnit } from '../../../hooks/useMask';\r\n+\r\n+\r\n+const CadastroVeiculoBIN = () => {\r\n+    const [placa, setPlaca] = useState('')\r\n+    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n+    const [unidade, setUnidade] = useState('')\r\n+    const [selectEstoque, setSelectEstoque] = useState('')\r\n+    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n+    const [cambio, setCambio] = useState('')\r\n+    const [quilometragem, setQuilometragem] = useState('')\r\n+    const [qtd_portas, setQtdPortas] = useState('')\r\n+\r\n+    //Buscando os dados da loja para o select\r\n+    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n+    // Ordena as lojas por descrição\r\n+    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n+\r\n+    //Buscando os dados na base BIN do Detran\r\n+    // A URL da API deve ser ajustada conforme a configuração do backend\r\n+    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n+\r\n+    const { createData } = usePostData('/veiculos');\r\n+    const { createEstoqueExtra } = usePostData('/pulmao');\r\n+\r\n+\r\n+    // Usando useRef para armazenar a última placa buscada\r\n+    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n+    const ultimaPlacaBuscada = useRef('');\r\n+\r\n+\r\n+    // Função para lidar com o evento de blur do campo placa\r\n+    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n+    const handleBlur = async () => {\r\n+        status(true)\r\n+        const placaM = placa.toUpperCase();\r\n+        \r\n+        if (placaM.length === 7) {\r\n+\r\n+\r\n+            const timeoutId = setTimeout(() => {\r\n+                window.alert(\r\n+                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n+                );\r\n+                window.location.reload();\r\n+            }, 120000);\r\n+\r\n+            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n+            // Só busca se a placa for diferente da última buscada\r\n+            if (placaM !== ultimaPlacaBuscada.current) {\r\n+                console.log('Buscando placa:', placaM); // Debug\r\n+                ultimaPlacaBuscada.current = placaM;\r\n+                setBuscaPlaca(placaM);\r\n+            }\r\n+            clearTimeout(timeoutId);\r\n+            loading(false); // Desativa o spinner\r\n+        }\r\n+    }\r\n+\r\n+    // Função para converter campos em CAIXA ALTA\r\n+    const toUpperFields = (obj, fields = []) => {\r\n+        const copy = { ...obj }\r\n+        fields.forEach((f) => {\r\n+            if (copy[f] !== undefined && copy[f] !== null) {\r\n+                copy[f] = String(copy[f]).toUpperCase()\r\n+            }\r\n+        })\r\n+        return copy\r\n+    }\r\n+\r\n+    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n+    const handleUnidadeChange = (e) => {\r\n+        const selectedOption = e.target.selectedOptions[0]\r\n+        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n+        const descricao = selectedOption.getAttribute('data-descricao')\r\n+\r\n+        setUnidade(descricao)\r\n+        setCnpjUnidade(cnpj)\r\n+        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n+    }\r\n+\r\n+\r\n+\r\n+    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n+    useEffect(() => {\r\n+\r\n+        if (veiculo && !veiculo.erro) {\r\n+\r\n+            // Atualizando o estado com os dados do veículo obtidos\r\n+            setBuscaPlaca(prev => ({\r\n+                ...prev,\r\n+                Fabricante: veiculo.Fabricante,\r\n+                MarcaModelo: veiculo.MarcaModelo,\r\n+                CorVeiculo: veiculo.CorVeiculo,\r\n+                AnoFabricacao: veiculo.AnoFabricacao,\r\n+                AnoModelo: veiculo.AnoModelo,\r\n+                renavam: veiculo.renavam,\r\n+                combustivel: veiculo.Combustivel,\r\n+                chassi: veiculo.chassi\r\n+            }))\r\n+        }\r\n+\r\n+    }, [veiculo])\r\n+\r\n+    // Funçao que eunvia os dados do veículo para o backend\r\n+    // Ela formata a data de registro e envia os dados para o backend\r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+        const data_registro = formatTimestamp(new Date());\r\n+\r\n+        let dados = {\r\n+            placa,\r\n+            data_registro,\r\n+            unidade,\r\n+            cambio,\r\n+            quilometragem,\r\n+            qtd_portas,\r\n+            cnpj_unidade,\r\n+            marca: veiculo.Fabricante,\r\n+            modelo: veiculo.MarcaModelo,\r\n+            cor: veiculo.CorVeiculo,\r\n+            ano_fabricacao: veiculo.AnoFabricacao,\r\n+            ano_modelo: veiculo.AnoModelo,\r\n+            renavan: veiculo.renavam,\r\n+            combustivel: veiculo.Combustivel,\r\n+            chassi: veiculo.chassi\r\n+        };\r\n+\r\n+        // normaliza os campos para maiúsculo\r\n+        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n+        console.log('Dados a serem enviados:', dados); // Debug\r\n+\r\n+        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n+        if (!confirmar) return;\r\n+\r\n+        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n+            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n+        } else {\r\n+            try {\r\n+                // Verifica se a placa já existe antes de enviar os dados\r\n+                const url = selectEstoque === 'pulmao'\r\n+                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n+                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n+\r\n+                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n+\r\n+                if (existente) {\r\n+                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n+                    return;\r\n+\r\n+                } else if (selectEstoque === 'pulmao') {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createEstoqueExtra(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+\r\n+                } else {\r\n+                    // Busca a quantidade de veículos na unidade selecionada\r\n+                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n+                    const data = await responseUnidade.json();\r\n+                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n+                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n+\r\n+                    // Busca a quantidade total de vagas da loja\r\n+                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n+                    const dataLoja = await responseLoja.json();\r\n+                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n+                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n+                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n+\r\n+                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n+                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n+                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n+\r\n+                    // Só permite o cadastro se houver vagas disponíveis\r\n+                    if (vagasDisponiveis > 0) {\r\n+                        const dadosUpper = toUpperCaseData(dados);\r\n+                        await createData(dadosUpper);\r\n+\r\n+                        window.alert('Veículo cadastrado com sucesso');\r\n+                        //window.location.reload();\r\n+                    } else {\r\n+                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error('Falha ao registrar o veículo: ', err);\r\n+                window.alert('Erro ao tentar registrar o veículo');\r\n+            }\r\n+        }\r\n+\r\n+\r\n+    };\r\n+\r\n+    return (\r\n+        <div>\r\n+            <ContainerSecundario>\r\n+                <div className='container d-flex flex-column ' id=\"path\" >\r\n+                    <div className=\"d-flex align-items-start \">\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <i className=' ti ti-angle-right ' id='card-path' />\r\n+                        </div>\r\n+                        <div className=\"p-2\">\r\n+                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+                <div className=\"container d-flex justify-content-center card-container\">\r\n+                    <Box >\r\n+                        <div className='panel-heading'>\r\n+                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n+                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n+                        </div>\r\n+                        <Form onSubmit={handleSubmit}>\r\n+                            <div className='col-12 col-md-3' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n+                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n+                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n+                                    {lojasOrdenadas.map((loja) => (\r\n+                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n+                                            {loja.descricao}\r\n+                                        </option>\r\n+                                    ))}\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className='col-12 col-md-4' id='select-all'>\r\n+                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n+                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n+                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n+                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n+                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-2\">\r\n+                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n+                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n+                            </div>\r\n+                            {/* Exibe o spinner de carregamento enquanto os dados estão sendo buscados */}\r\n+                            {loading && (\r\n+                                <div className=\"spinner-border\" role=\"status\"></div>\r\n+                            )}\r\n+                            \r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n+                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n+                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n+                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n+                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n+                                    <option value=\"manual\">MANUAL</option>\r\n+                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n+                                </select>\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n+                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n+                                    value={veiculo.AnoFabricacao} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-3\">\r\n+                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"col-12 col-md-4\">\r\n+                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n+                            </div>\r\n+                            <div className=\"d-flex flex-row-reverse\" >\r\n+                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                            </div>\r\n+\r\n+\r\n+                        </Form>\r\n+                    </Box>\r\n+                </div>\r\n+\r\n+            </ContainerSecundario>\r\n+        </div>\r\n+    )\r\n+}\r\n+\r\n+export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770124557574,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -324,9 +324,9 @@\n                             <div className=\"col-12 col-md-4\">\r\n                                 <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n                             </div>\r\n                             <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n+                                <Button onClick={handleSubmit} variant='primary'>ENVIAR</Button>\r\n                             </div>\r\n \r\n \r\n                         </Form>\r\n@@ -338,1024 +338,4 @@\n     )\r\n }\r\n \r\n export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {/* }\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            {/**/ */}\r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n-import \"../../../assets/css/thead.css\";\r\n-import \"../../../assets/css/themify-icons.css\"\r\n-import Form from '../../../components/form/Form';\r\n-import Box from \"../../../components/box/Box\"\r\n-import ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\n-import Input from '../../../components/input/Input';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { useGetData } from '../../../services/useGetData';\r\n-import { usePostData } from '../../../services/usePostData';\r\n-import { formatTimestamp } from '../../../hooks/formatDate';\r\n-import { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\n-import Button from '../../../components/button/Button';\r\n-import { formatMillionUnit } from '../../../hooks/useMask';\r\n-\r\n-\r\n-const CadastroVeiculoBIN = () => {\r\n-    const [placa, setPlaca] = useState('')\r\n-    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n-    const [unidade, setUnidade] = useState('')\r\n-    const [selectEstoque, setSelectEstoque] = useState('')\r\n-    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n-    const [cambio, setCambio] = useState('')\r\n-    const [quilometragem, setQuilometragem] = useState('')\r\n-    const [qtd_portas, setQtdPortas] = useState('')\r\n-\r\n-    //Buscando os dados da loja para o select\r\n-    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n-    // Ordena as lojas por descrição\r\n-    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n-\r\n-    //Buscando os dados na base BIN do Detran\r\n-    // A URL da API deve ser ajustada conforme a configuração do backend\r\n-    const { loading, data: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n-\r\n-    const { createData } = usePostData('/veiculos');\r\n-    const { createEstoqueExtra } = usePostData('/pulmao');\r\n-\r\n-\r\n-    // Usando useRef para armazenar a última placa buscada\r\n-    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n-    const ultimaPlacaBuscada = useRef('');\r\n-\r\n-\r\n-    // Função para lidar com o evento de blur do campo placa\r\n-    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n-    const handleBlur = async () => {\r\n-        status(true)\r\n-        const placaM = placa.toUpperCase();\r\n-        \r\n-        if (placaM.length === 7) {\r\n-\r\n-\r\n-            const timeoutId = setTimeout(() => {\r\n-                window.alert(\r\n-                    \"BASE BIN offline ou dados do veiculo indisponiveis. Tente novamente ou realize o cadastro de forma manual. \"\r\n-                );\r\n-                window.location.reload();\r\n-            }, 120000);\r\n-\r\n-            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n-            // Só busca se a placa for diferente da última buscada\r\n-            if (placaM !== ultimaPlacaBuscada.current) {\r\n-                console.log('Buscando placa:', placaM); // Debug\r\n-                ultimaPlacaBuscada.current = placaM;\r\n-                setBuscaPlaca(placaM);\r\n-            }\r\n-            clearTimeout(timeoutId);\r\n-            loading(false); // Desativa o spinner\r\n-        }\r\n-    }\r\n-\r\n-    // Função para converter campos em CAIXA ALTA\r\n-    const toUpperFields = (obj, fields = []) => {\r\n-        const copy = { ...obj }\r\n-        fields.forEach((f) => {\r\n-            if (copy[f] !== undefined && copy[f] !== null) {\r\n-                copy[f] = String(copy[f]).toUpperCase()\r\n-            }\r\n-        })\r\n-        return copy\r\n-    }\r\n-\r\n-    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n-    const handleUnidadeChange = (e) => {\r\n-        const selectedOption = e.target.selectedOptions[0]\r\n-        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n-        const descricao = selectedOption.getAttribute('data-descricao')\r\n-\r\n-        setUnidade(descricao)\r\n-        setCnpjUnidade(cnpj)\r\n-        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n-    }\r\n-\r\n-\r\n-\r\n-    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n-    useEffect(() => {\r\n-\r\n-        if (veiculo && !veiculo.erro) {\r\n-\r\n-            // Atualizando o estado com os dados do veículo obtidos\r\n-            setBuscaPlaca(prev => ({\r\n-                ...prev,\r\n-                Fabricante: veiculo.Fabricante,\r\n-                MarcaModelo: veiculo.MarcaModelo,\r\n-                CorVeiculo: veiculo.CorVeiculo,\r\n-                AnoFabricacao: veiculo.AnoFabricacao,\r\n-                AnoModelo: veiculo.AnoModelo,\r\n-                renavam: veiculo.renavam,\r\n-                combustivel: veiculo.Combustivel,\r\n-                chassi: veiculo.chassi\r\n-            }))\r\n-        }\r\n-\r\n-    }, [veiculo])\r\n-\r\n-    // Funçao que eunvia os dados do veículo para o backend\r\n-    // Ela formata a data de registro e envia os dados para o backend\r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n-        const data_registro = formatTimestamp(new Date());\r\n-\r\n-        let dados = {\r\n-            placa,\r\n-            data_registro,\r\n-            unidade,\r\n-            cambio,\r\n-            quilometragem,\r\n-            qtd_portas,\r\n-            cnpj_unidade,\r\n-            marca: veiculo.Fabricante,\r\n-            modelo: veiculo.MarcaModelo,\r\n-            cor: veiculo.CorVeiculo,\r\n-            ano_fabricacao: veiculo.AnoFabricacao,\r\n-            ano_modelo: veiculo.AnoModelo,\r\n-            renavan: veiculo.renavam,\r\n-            combustivel: veiculo.Combustivel,\r\n-            chassi: veiculo.chassi\r\n-        };\r\n-\r\n-        // normaliza os campos para maiúsculo\r\n-        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n-        console.log('Dados a serem enviados:', dados); // Debug\r\n-\r\n-        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n-        if (!confirmar) return;\r\n-\r\n-        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n-            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n-        } else {\r\n-            try {\r\n-                // Verifica se a placa já existe antes de enviar os dados\r\n-                const url = selectEstoque === 'pulmao'\r\n-                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n-                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n-\r\n-                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n-\r\n-                if (existente) {\r\n-                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n-                    return;\r\n-\r\n-                } else if (selectEstoque === 'pulmao') {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createEstoqueExtra(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-\r\n-                } else {\r\n-                    // Busca a quantidade de veículos na unidade selecionada\r\n-                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n-                    const data = await responseUnidade.json();\r\n-                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n-                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n-\r\n-                    // Busca a quantidade total de vagas da loja\r\n-                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n-                    const dataLoja = await responseLoja.json();\r\n-                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n-                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n-                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n-\r\n-                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n-                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n-                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n-\r\n-                    // Só permite o cadastro se houver vagas disponíveis\r\n-                    if (vagasDisponiveis > 0) {\r\n-                        const dadosUpper = toUpperCaseData(dados);\r\n-                        await createData(dadosUpper);\r\n-\r\n-                        window.alert('Veículo cadastrado com sucesso');\r\n-                        //window.location.reload();\r\n-                    } else {\r\n-                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error('Falha ao registrar o veículo: ', err);\r\n-                window.alert('Erro ao tentar registrar o veículo');\r\n-            }\r\n-        }\r\n-\r\n-\r\n-    };\r\n-\r\n-    return (\r\n-        <div>\r\n-            <ContainerSecundario>\r\n-                <div className='container d-flex flex-column ' id=\"path\" >\r\n-                    <div className=\"d-flex align-items-start \">\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <i className=' ti ti-angle-right ' id='card-path' />\r\n-                        </div>\r\n-                        <div className=\"p-2\">\r\n-                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-                <div className=\"container d-flex justify-content-center card-container\">\r\n-                    <Box >\r\n-                        <div className='panel-heading'>\r\n-                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n-                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n-                        </div>\r\n-                        <Form onSubmit={handleSubmit}>\r\n-                            <div className='col-12 col-md-3' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n-                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n-                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n-                                    {lojasOrdenadas.map((loja) => (\r\n-                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n-                                            {loja.descricao}\r\n-                                        </option>\r\n-                                    ))}\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className='col-12 col-md-4' id='select-all'>\r\n-                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n-                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n-                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n-                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n-                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-2\">\r\n-                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n-                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n-                            </div>\r\n-                            \r\n-                            {loading && (\r\n-                                <div className=\"spinner-border\" role=\"status\"></div>\r\n-                            )}\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n-                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n-                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n-                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n-                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n-                                    <option value=\"manual\">MANUAL</option>\r\n-                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n-                                </select>\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n-                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n-                                    value={veiculo.AnoFabricacao} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-3\">\r\n-                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"col-12 col-md-4\">\r\n-                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n-                            </div>\r\n-                            <div className=\"d-flex flex-row-reverse\" >\r\n-                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n-                            </div>\r\n-\r\n-\r\n-                        </Form>\r\n-                    </Box>\r\n-                </div>\r\n-\r\n-            </ContainerSecundario>\r\n-        </div>\r\n-    )\r\n-}\r\n-\r\n-export default CadastroVeiculoBIN\r\n"
                },
                {
                    "date": 1770124577984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -326,10 +326,8 @@\n                             </div>\r\n                             <div className=\"d-flex flex-row-reverse\" >\r\n                                 <Button onClick={handleSubmit} variant='primary'>ENVIAR</Button>\r\n                             </div>\r\n-\r\n-\r\n                         </Form>\r\n                     </Box>\r\n                 </div>\r\n \r\n"
                }
            ],
            "date": 1769800675405,
            "name": "Commit-0",
            "content": "import \"../../../assets/css/thead.css\";\r\nimport \"../../../assets/css/themify-icons.css\"\r\nimport Form from '../../../components/form/Form';\r\nimport Box from \"../../../components/box/Box\"\r\nimport ContainerSecundario from \"../../../components/container/ContainerSecundario\"\r\nimport Input from '../../../components/input/Input';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useGetData } from '../../../services/useGetData';\r\nimport { usePostData } from '../../../services/usePostData';\r\nimport { formatTimestamp } from '../../../hooks/formatDate';\r\nimport { toUpperCaseData } from '../../../hooks/transformToUppercase';\r\nimport Button from '../../../components/button/Button';\r\nimport { formatMillionUnit } from '../../../hooks/useMask';\r\n\r\n\r\nconst CadastroVeiculoBIN = () => {\r\n    const [placa, setPlaca] = useState('')\r\n    const [buscaPlaca, setBuscaPlaca] = useState([]);\r\n    const [unidade, setUnidade] = useState('')\r\n    const [selectEstoque, setSelectEstoque] = useState('')\r\n    const [cnpj_unidade, setCnpjUnidade] = useState('')\r\n    const [cambio, setCambio] = useState('')\r\n    const [quilometragem, setQuilometragem] = useState('')\r\n    const [qtd_portas, setQtdPortas] = useState('')\r\n\r\n    //Buscando os dados da loja para o select\r\n    const { data: dadosLoja, } = useGetData(`/lojas`);\r\n    // Ordena as lojas por descrição\r\n    const lojasOrdenadas = dadosLoja.sort((a, b) => a.descricao.localeCompare(b.descricao))\r\n\r\n    //Buscando os dados na base BIN do Detran\r\n    // A URL da API deve ser ajustada conforme a configuração do backend\r\n    const { loadingdata: veiculo, } = useGetData(buscaPlaca ? `/veiculos/dados?placa=${placa}` : '');\r\n    console.log('Dados do veículo buscado:', veiculo); // Debug\r\n\r\n    const { createData } = usePostData('/veiculos');\r\n    const { createEstoqueExtra } = usePostData('/pulmao');\r\n\r\n\r\n    // Usando useRef para armazenar a última placa buscada\r\n    // Isso evita que a busca seja feita repetidamente para a mesma placa\r\n    const ultimaPlacaBuscada = useRef('');\r\n\r\n\r\n    // Função para lidar com o evento de blur do campo placa\r\n    // Ela verifica se a placa tem 7 caracteres e se é diferente da última buscada\r\n    const handleBlur = () => {\r\n        const placaM = placa.toUpperCase();\r\n        if (placaM.length === 7) {\r\n            // Só busca se a placa for diferente da última buscada\r\n            if (placaM !== ultimaPlacaBuscada.current) {\r\n                console.log('Buscando placa:', placaM); // Debug\r\n                ultimaPlacaBuscada.current = placaM;\r\n                setBuscaPlaca(placaM);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Função para converter campos em CAIXA ALTA\r\n    const toUpperFields = (obj, fields = []) => {\r\n        const copy = { ...obj }\r\n        fields.forEach((f) => {\r\n            if (copy[f] !== undefined && copy[f] !== null) {\r\n                copy[f] = String(copy[f]).toUpperCase()\r\n            }\r\n        })\r\n        return copy\r\n    }\r\n\r\n    // Função para lidar com a seleção de unidade e busca do CNPJ\r\n    const handleUnidadeChange = (e) => {\r\n        const selectedOption = e.target.selectedOptions[0]\r\n        const cnpj = selectedOption.getAttribute('data-cnpj')\r\n        const descricao = selectedOption.getAttribute('data-descricao')\r\n\r\n        setUnidade(descricao)\r\n        setCnpjUnidade(cnpj)\r\n        console.log('State atualizado - Loja:', descricao, 'CNPJ:', cnpj);\r\n    }\r\n\r\n\r\n\r\n    // Atualiza os campos do formulário quando os dados do veículo são carregados\r\n    useEffect(() => {\r\n\r\n        if (veiculo && !veiculo.erro) {\r\n\r\n            // Atualizando o estado com os dados do veículo obtidos\r\n            setBuscaPlaca(prev => ({\r\n                ...prev,\r\n                Fabricante: veiculo.Fabricante,\r\n                MarcaModelo: veiculo.MarcaModelo,\r\n                CorVeiculo: veiculo.CorVeiculo,\r\n                AnoFabricacao: veiculo.AnoFabricacao,\r\n                AnoModelo: veiculo.AnoModelo,\r\n                renavam: veiculo.renavam,\r\n                combustivel: veiculo.Combustivel,\r\n                chassi: veiculo.chassi\r\n            }))\r\n        }\r\n\r\n    }, [veiculo])\r\n\r\n    // Funçao que eunvia os dados do veículo para o backend\r\n    // Ela formata a data de registro e envia os dados para o backend\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        const data_registro = formatTimestamp(new Date());\r\n\r\n        let dados = {\r\n            placa,\r\n            data_registro,\r\n            unidade,\r\n            cambio,\r\n            quilometragem,\r\n            qtd_portas,\r\n            cnpj_unidade,\r\n            marca: veiculo.Fabricante,\r\n            modelo: veiculo.MarcaModelo,\r\n            cor: veiculo.CorVeiculo,\r\n            ano_fabricacao: veiculo.AnoFabricacao,\r\n            ano_modelo: veiculo.AnoModelo,\r\n            renavan: veiculo.renavam,\r\n            combustivel: veiculo.Combustivel,\r\n            chassi: veiculo.chassi\r\n        };\r\n\r\n        // normaliza os campos para maiúsculo\r\n        dados = toUpperFields(dados, ['placa', 'marca', 'modelo', 'cor', 'unidade', 'combustivel']);\r\n        console.log('Dados a serem enviados:', dados); // Debug\r\n\r\n        const confirmar = window.confirm(\"Confirma o cadastro do veículo?\");\r\n        if (!confirmar) return;\r\n\r\n        if (confirmar && quilometragem === \"\" || cambio === \"\" || qtd_portas === \"\") {\r\n            window.alert(\"Por favor, verifique o formulario novamente Todos os campos precisam ser preenchidos.\")\r\n        } else {\r\n            try {\r\n                // Verifica se a placa já existe antes de enviar os dados\r\n                const url = selectEstoque === 'pulmao'\r\n                    ? `${import.meta.env.VITE_API_BASE_URL}/pulmao/placa/${dados.placa}`\r\n                    : `${import.meta.env.VITE_API_BASE_URL}/veiculos/placa/${dados.placa}`;\r\n\r\n                const existente = await fetch(url).then((res) => res.ok ? res.json() : null);\r\n\r\n                if (existente) {\r\n                    window.alert(\"Já existe um veículo cadastrado com esta placa!\");\r\n                    return;\r\n\r\n                } else if (selectEstoque === 'pulmao') {\r\n                    // Busca a quantidade de veículos na unidade selecionada\r\n                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/pulmao/unidade/${unidade}`);\r\n                    const data = await responseUnidade.json();\r\n                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n\r\n                    // Busca a quantidade total de vagas da loja\r\n                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n                    const dataLoja = await responseLoja.json();\r\n                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n                    const vagasTotais = parseInt(loja.qtdEstoqueExtra, 10);\r\n                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n\r\n                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n\r\n                    // Só permite o cadastro se houver vagas disponíveis\r\n                    if (vagasDisponiveis > 0) {\r\n                        const dadosUpper = toUpperCaseData(dados);\r\n                        await createEstoqueExtra(dadosUpper);\r\n\r\n                        window.alert('Veículo cadastrado no Pulmao com sucesso');\r\n                        //window.location.reload();\r\n                    } else {\r\n                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n                    }\r\n\r\n                } else {\r\n                    // Busca a quantidade de veículos na unidade selecionada\r\n                    const responseUnidade = await fetch(`${import.meta.env.VITE_API_BASE_URL}/veiculos/unidade/${unidade}`);\r\n                    const data = await responseUnidade.json();\r\n                    const filteredResults = data.filter((veiculo) => veiculo.placa !== \"\").length;\r\n                    console.log(\"Quantidade de veiculos: \", filteredResults);\r\n\r\n                    // Busca a quantidade total de vagas da loja\r\n                    const responseLoja = await fetch(`${import.meta.env.VITE_API_BASE_URL}/lojas`);\r\n                    const dataLoja = await responseLoja.json();\r\n                    const loja = dataLoja.find((loja) => loja.descricao === dados.unidade);\r\n                    const vagasTotais = parseInt(loja.qtdVeiculos, 10);\r\n                    console.log(\"Quantidade de vagas informadas no cadastro da loja: \", vagasTotais);\r\n\r\n                    //Vagas disponiveis sera obtido da subtração das vagas totais informado no cadastro da loja menos a quantidade de veiculos ja cadastrados\r\n                    const vagasDisponiveis = vagasTotais - filteredResults;\r\n                    console.log(`Quantidade de vagas disponíveis: ${vagasDisponiveis - 1}`);\r\n\r\n                    // Só permite o cadastro se houver vagas disponíveis\r\n                    if (vagasDisponiveis > 0) {\r\n                        const dadosUpper = toUpperCaseData(dados);\r\n                        await createData(dadosUpper);\r\n\r\n                        window.alert('Veículo cadastrado com sucesso');\r\n                        //window.location.reload();\r\n                    } else {\r\n                        window.alert('Não há vagas disponíveis para esta loja. Cadastro não realizado.');\r\n                    }\r\n                }\r\n\r\n            } catch (err) {\r\n                console.error('Falha ao registrar o veículo: ', err);\r\n                window.alert('Erro ao tentar registrar o veículo');\r\n            }\r\n        }\r\n\r\n\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <ContainerSecundario>\r\n                <div className='container d-flex flex-column ' id=\"path\" >\r\n                    <div className=\"d-flex align-items-start \">\r\n                        <div className=\"p-2\">\r\n                            <a className=\"link_a\" href=\"/\">Gestão</a>\r\n                        </div>\r\n                        <div className=\"p-2\">\r\n                            <i className=' ti ti-angle-right ' id='card-path' />\r\n                        </div>\r\n                        <div className=\"p-2\">\r\n                            <a className=\"link_a\" href=\"/gestao_estoque\">Gestão de Estoque</a>\r\n                        </div>\r\n                        <div className=\"p-2\">\r\n                            <i className=' ti ti-angle-right ' id='card-path' />\r\n                        </div>\r\n                        <div className=\"p-2\">\r\n                            <p className='atual'>Cadastro de Veiculos (Base BIN) </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"container d-flex justify-content-center card-container\">\r\n                    <Box >\r\n                        <div className='panel-heading'>\r\n                            <i className='ti ti-car' id=\"ti-black\" ></i>\r\n                            <p>CADASTRO DE VEICULOS COM CONSULTA À BASE BIN <br /> Selecione a loja e informe a placa do veículo para buscar os dados na Base BIN do Detran</p>\r\n                        </div>\r\n                        <Form onSubmit={handleSubmit}>\r\n                            <div className='col-12 col-md-3' id='select-all'>\r\n                                <label className=\"label\" id=\"select-label\"><span>Loja:</span></label>\r\n                                <select type='text' name='loja' value={unidade} onChange={handleUnidadeChange} className=\"select-item\" required >\r\n                                    <option value=\"\" >SELECIONE UMA LOJA</option>\r\n                                    {lojasOrdenadas.map((loja) => (\r\n                                        <option key={loja.descricao} value={loja.descricao} data-descricao={loja.descricao} data-cnpj={loja.cnpj}>\r\n                                            {loja.descricao}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                            <div className='col-12 col-md-4' id='select-all'>\r\n                                <label className=\"label\" id=\"select-label\"><span>Estoque:</span></label>\r\n                                <select type='text' name='loja' value={selectEstoque} onChange={(e) => setSelectEstoque(e.target.value)} className=\"select-item\" required >\r\n                                    <option value='' >SELECIONE UM ESTOQUE</option>\r\n                                    <option value='veiculos'>ESTOQUE PRINCIPAL</option>\r\n                                    <option values='pulmao'>ESTOQUE EXTRA</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Placa:\"} type={\"text\"} maxLength={\"7\"} style={{ width: '80px' }} nameInput={\"placa\"}\r\n                                    value={placa} onChange={(e) => setPlaca(e.target.value)} onBlur={handleBlur} required />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Marca:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"marca\"} value={veiculo.Fabricante} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-4\">\r\n                                <Input label={\"Modelo:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"modelo\"} value={veiculo.MarcaModelo} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-4\">\r\n                                <Input label={\"Cor:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"cor\"} value={veiculo.CorVeiculo} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Combustível:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"combustivel\"} value={veiculo.Combustivel} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Km:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"quilometragem\"} value={quilometragem}\r\n                                    onChange={(e) => setQuilometragem(formatMillionUnit(e.target.value))} required />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-4\" id=\"select-all\">\r\n                                <label className=\"label\" id=\"select-label\"><span>Câmbio:</span></label>\r\n                                <select label={\"Cambio:\"} type={\"text\"} style={{ width: '260px' }} value={cambio} onChange={(e) => setCambio(e.target.value)}>\r\n                                    <option value=\"\">SELECIONE O TIPO DE CÂMBIO</option>\r\n                                    <option value=\"manual\">MANUAL</option>\r\n                                    <option value=\"automatico\">AUTOMÁTICO</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Qtd Portas:\"} type={\"text\"} style={{ width: '50px' }} nameInput={\"qtdPortas\"} value={qtd_portas}\r\n                                    onChange={(e) => setQtdPortas(e.target.value)} required />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Ano Fabricacao:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"anoFabricacao\"}\r\n                                    value={veiculo.AnoFabricacao} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-3\">\r\n                                <Input label={\"Ano Modelo:\"} type={\"text\"} style={{ width: '80px' }} nameInput={\"veiculo\"} value={veiculo.AnoModelo} required readOnly />\r\n                            </div>\r\n                            <div className=\"col-12 col-md-4\">\r\n                                <Input label={\"Renavam:\"} type={\"text\"} style={{ width: '150px' }} nameInput={\"renavam\"} value={veiculo.renavam} required readOnly />\r\n                            </div>\r\n                            <div className=\"d-flex flex-row-reverse\" >\r\n                                <Button onClick={handleSubmit} variant='primary' >ENVIAR</Button>\r\n                            </div>\r\n\r\n\r\n                        </Form>\r\n                    </Box>\r\n                </div>\r\n\r\n            </ContainerSecundario>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default CadastroVeiculoBIN\r\n"
        }
    ]
}